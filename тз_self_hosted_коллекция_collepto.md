# Техническое задание
## Self-hosted шаблон сайта коллекционера (Collepto)

### Краткое описание

Collepto — сайт для одного коллекционера, который легко развернуть на Cloudflare Workers одной командой. Сайт публичный, управление (админка) — только для владельца через Basic-Auth. Проект ориентирован на ведение коллекции с расширенными возможностями по фото, блогом, экспортом данных и удобным просмотром коллекции.

---

## 1. Авторизация и доступ
- **Один пользователь (владелец), вход через Basic-Auth**
  - Логин и пароль указываются в wrangler.toml как переменные Worker.
  - Срок жизни сессии — 30 дней (через cookie).
  - Изменить пароль можно только через конфиг (toml), через интерфейс смена пароля не предусмотрена.
  - Защита от брутфорса: после 3 неудачных попыток — блокировка формы на 5 минут и оповещение в личном кабинете о попытке входа.

---

## 2. Структура коллекции и предметов
- **Item** (коллекционный предмет) содержит поля:
  - `Название`
  - `Описание` (может быть пустым)
  - `Год выпуска` или `Диапазон лет`
  - `Страна производства`
  - `Организация/издатель`
  - `Размер` (свободный текст)
  - `Тираж` (свободный текст)
  - `Серия` (свободный текст)
  - `Теги` (свободный формат, можно редактировать и удалять)
  - `Фотографии` (до 10 фото на item)
- Любой item можно редактировать или удалять в любой момент.
- На главной и в фильтрах/поиске отображается **summary** (количество предметов, уникальных тегов, стран, топ популярных тегов и др.)

---

## 3. Работа с фотографиями
- Фото загружаются через drag&drop (или стандартную форму)
- При загрузке:
  - Оригиналы (любых поддерживаемых форматов) хранятся в `/assets` (до 25 МБ/фото)
  - Для сайта автоматически создаются JPG-копии фото: сжимаются до 80% качества, не более 1920px по длинной стороне.
  - На сайте используются только сжатые JPG (для быстрой загрузки)
- Для каждого item:
  - На странице предмета — удобная галерея (стильная, с листалкой, просмотром полноразмерного фото)
  - На странице коллекции — миниатюры всех фото для каждого предмета
- При удалении фото у предмета:
  - Оригинал остается в assets (для экспорта), сжатая копия удаляется

---

## 4. Экспорт коллекции
- **Экспорт реализован как кнопка в админке:**
  - Все оригиналы фото экспортируются в одну папку (zip-архив)
  - Текстовые данные экспортируются в CSV (каждый item, все его параметры, плюс список файлов оригиналов, которые к нему относятся)
  - Связи item ↔ фото отражаются только в CSV
  - Экспортируется вся коллекция сразу (выборочно — не нужно)
- Импорт коллекции обратно не поддерживается
- Прогресс заполнения assets (процент занятого места) выводится в админке

---

## 5. Интерфейс и страницы
- **Публичная часть сайта**
  - Главная страница:
    - Блог автора (5 последних статей, каждая может быть связана с одним или несколькими items; под статьей видно, к каким предметам относится) плюс пагинатор для просмотра более старых статей.
    - Блок “Новое” — 5 последних выложенных предметов
  - Страница коллекции:
    - Список всех items (поле поиска, фильтрация, сортировка)
    - У каждого item краткое описание, теги, миниатюры фото, кнопка “подробнее”
  - Страница item:
    - Полное описание, параметры, теги, стильная галерея фото
    - Кнопка “Поделиться” — копирует уникальный URL item в буфер обмена
- **Админка** (доступ только по Basic-Auth):
  - CRUD для items (создать, редактировать, удалить)
  - Галерея для управления фото у item (drag&drop)
  - CRUD для блога (добавить, удалить, редактировать, писать в markdown)
  - Поиск, фильтрация, сортировка по любым параметрам
  - Кнопка “Экспортировать” (CSV + архив фото)
  - Индикация занятого места в assets (в процентах)

---

## 6. Блог
- Статьи можно создавать, редактировать, удалять через админку
- Редактор — только markdown (plain textarea, подсказки синтаксиса)
- В блоге: красивые стилизованные карточки, привязка статей к предметам коллекции
- На главной только 5 последних статей (далее — “читать ещё”)
- Имя автора можно редактировать в личном кабинете администратора

---

## 7. Поиск и фильтры
- Поиск по названию и описанию (полнотекстовый)
- Фильтры по:
  - Году или диапазону лет
  - Стране
  - Организации
  - Тиражу
  - Тегам
- Сортировка по дате добавления, году производства и алфавиту

---

## 8. Ограничения
- До 10 фото на item
- Оригиналы фото — до 25 МБ/файл, хранятся в assets
- Общий лимит только по Cloudflare Assets (отображается прогресс заполнения в админке)
- Нет лимита на количество предметов
- Фото всегда сжимаются до 80% jpg, макс. 1920px

---

## 9. Безопасность
- Basic-Auth только для админки
- Публичная часть сайта доступна всем
- Нет возможности смены пароля через UI
- После 3 неудачных попыток логина — блокировка формы + сообщение в личном кабинете


---

## 10. Локализация
- Только русский язык интерфейса

---

## 11. Обновление
- Нет автоапдейтера, обновление вручную (pull из репозитория + redeploy)

---

## 12. Технологии
- **Cloudflare Workers** (бэкенд, отдача страниц и api)
- **Cloudflare Assets** (хранение фото)
- **Cloudflare D1 SQL Database** (хранение items, blog posts)
- **React** (фронтенд, сборка)
- **Sharp** (для ресайза фото)
- **TypeScript** (весь проект)
- **CSV export** (для экспорта)
- **[shadcn/ui]** (для стильных интерфейсов)**
- Markdown (блог)

## 13. SEO - поисковая оптимизация
- Все страницы снабжены метатегами и другой полезной информацией для облегчения работы роботов и краулеров
- Все изображения автоматически снабжаются alt текстом, который берется из названия item
- Кнопка "Share" выдает ссылку, которая удобно и красиво вставляется в любые соцсети, формируя красивый превью


## 14. Структура проекта (пример)
- `/src` — фронтенд и backend logic
- `/assets` — оригиналы фото (cloudflare assets)
- `/resized` — сжатые версии фото для сайта
- `/blog` — markdown-файлы статей
- `wrangler.toml` — переменные окружения, логин/пароль, конфиг
- `/export` — функция экспорта (csv+архив фото)

---

## 15. Развёртывание
-  `wrangler deploy`
- Все инструкции по настройке (логин, пароль, лимиты, экспорт) — в `README.md`

---


